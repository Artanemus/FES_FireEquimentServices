Option Compare Database
Option Explicit

Const ModuleName As String = "xDlgSite_Link"
Private CompanyCodeStr As String

Private Sub cmdCancel_Click()
    mdlSite.ReturnValue = False
    Me.Visible = False
End Sub

Private Sub cmdOK_Click()
Dim Msg As String
    
    On Error GoTo PROC_ERR
    mdlSite.ReturnValue = True
    Me.Visible = False
    
PROC_EXIT:
    On Error Resume Next
    Exit Sub

PROC_ERR:
    ' display the system error
    If err.Number <> 0 Then
        Msg = ModuleName & " cmdOK_Click" & vbCrLf & _
              "Error # " & CStr(err.Number) & " was generated by " & err.Source & vbCrLf & err.Description
        MsgBox Msg, , "Error", err.HelpFile, err.HelpContext
    End If
    Resume PROC_EXIT
    
End Sub

Private Sub Form_KeyDown(KeyCode As Integer, Shift As Integer)
    If KeyCode = vbKeyEscape Then
        cmdCancel_Click
        KeyCode = 0
    End If
End Sub

Private Sub Form_Load()
Dim Msg As String
    
    On Error GoTo PROC_ERR
    
    CompanyCodeStr = mdlCompany.GetCompanyCode
    Me.lblCompanyCode.Caption = CompanyCodeStr
    DynamicResize
    mdlSite.ReturnValue = False
        
PROC_EXIT:
    On Error Resume Next
    Exit Sub

PROC_ERR:
    ' display the system error
    If err.Number <> 0 Then
        Msg = ModuleName & " Form_Load" & vbCrLf & _
              "Error # " & CStr(err.Number) & " was generated by " & err.Source & vbCrLf & err.Description
        MsgBox Msg, , "Error", err.HelpFile, err.HelpContext
    End If
    Resume PROC_EXIT
    
End Sub

Private Sub Form_Open(Cancel As Integer)
Dim v As Variant
Dim Msg As String
Dim s As String
Dim aSiteID As Long
Dim aCustomerID As Long

    On Error GoTo PROC_ERR
    
    If Len(Me.OpenArgs) > 0 Then
    
        ' ArgCount - Base is 0
        ' CustomerID
        ' -------------------------------------------------
        v = mdlOpenArgs.AssertParseOpenArgs(Me.OpenArgs, 0)
        If Nz(v, 0) > 0 Then
            aCustomerID = CLng(v)
        Else
            Cancel = True
            Exit Sub
        End If
        
        ' SiteID
        ' -------------------------------------------------
        v = mdlOpenArgs.AssertParseOpenArgs(Me.OpenArgs, 1)
        If Nz(v, 0) > 0 Then
            aSiteID = CLng(v)
        Else
            Cancel = True
            Exit Sub
        End If
        
        ' filter the recordset on SiteID
        Me.Filter = "[SiteID] = " & CStr(aSiteID)
        If Me.FilterOn = False Then Me.FilterOn = True
        
        ' CAPTION set the customer label in title bar
        s = mdlCust.GetCustName(aCustomerID)
        lblCustomerName.Caption = s
        
        ' CAPTION set the site address in the bar
        s = mdlSite.GetSitexAddress(aSiteID)
        lblSiteAddress.Caption = s
        
        ' CAPTION set the site ID
        s = Format(aSiteID, "0000")
        lblSiteID.Caption = s
        
    End If

PROC_EXIT:
    On Error Resume Next
    Exit Sub

PROC_ERR:
    ' display the system error
    If err.Number <> 0 Then
        Msg = ModuleName & " Form_Open" & vbCrLf & _
              "Error # " & CStr(err.Number) & " was generated by " & err.Source & vbCrLf & err.Description
        MsgBox Msg, , "Error", err.HelpFile, err.HelpContext
    End If
    Resume PROC_EXIT
    
End Sub


Private Sub DynamicResize()
    'Me. was replaced with aForm.
    ''If Not mPassed Then Exit Sub

    'Variables
    'Dim lngCount As Long
    Dim lngWindowHeight As Long
    Dim lngOldWindowHeight As Long
    Dim lngDeltaTop As Long
    'Dim lngMaxRecordsToShow As Long
    'Dim lngMinRecordsToShow As Long
    'Dim SF_DetailedHeight As Long
    

    'Enable vertical scrollbar
    ' Me.ScrollBars = 2                     'Vertical


    lngWindowHeight = Me.FormHeader.Height + _
                      (Me.Detail.Height * 10) + _
                      Me.FormFooter.Height + _
                      567
    'The 567 is to account for title bar Height.
    'If you use thin border, adjust accordingly

    'The form will be "shortened" and we need to adjust the top property as well to keep it properly centered
    lngOldWindowHeight = Me.WindowHeight
    lngDeltaTop = (lngOldWindowHeight - lngWindowHeight) / 2

    'Use the move function to move the form

    Me.Move Me.WindowLeft, Me.WindowTop + lngDeltaTop, , lngWindowHeight

End Sub

